<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Planner System | ttb</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #f9fafb;
            color: #1f2937;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes scaleUp {
            from { 
                transform: scale(0.9); 
                opacity: 0; 
            }
            to { 
                transform: scale(1); 
                opacity: 1; 
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        @keyframes bounceSubtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes progressWidth {
            0%, 100% { width: 0%; left: 0; }
            50% { width: 100%; left: 0; }
            100% { left: 100%; }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.5s ease-out;
        }

        .animate-scale-up {
            animation: scaleUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .animate-shake {
            animation: shake 0.4s ease-in-out;
        }

        .animate-bounce-subtle {
            animation: bounceSubtle 2s infinite;
        }

        /* Loading Screen */
        #loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #002d63 0%, #005099 100%);
            color: white;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .loading-bg-circle1 {
            position: absolute;
            top: 0;
            left: 0;
            width: 256px;
            height: 256px;
            background-color: white;
            opacity: 0.05;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            filter: blur(48px);
        }

        .loading-bg-circle2 {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 384px;
            height: 384px;
            background-color: #f97316;
            opacity: 0.1;
            border-radius: 50%;
            transform: translate(33%, 33%);
            filter: blur(48px);
        }

        .loading-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo-container {
            margin-bottom: 32px;
            padding: 16px;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .logo-text {
            color: #002d63;
            font-weight: bold;
            font-size: 36px;
            letter-spacing: -0.025em;
        }

        .loading-title {
            font-size: 30px;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .loading-subtitle {
            color: #bfdbfe;
            margin-bottom: 48px;
            text-align: center;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        .progress-container {
            width: 256px;
        }

        .progress-bar {
            height: 6px;
            background-color: #1e3a8a;
            opacity: 0.3;
            border-radius: 9999px;
            overflow: hidden;
            backdrop-filter: blur(4px);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #f97316, #ea580c);
            animation: progressWidth 1.5s ease-in-out infinite;
        }

        .progress-text {
            text-align: center;
            font-size: 12px;
            color: #93c5fd;
            opacity: 0.8;
            margin-top: 8px;
        }

        .start-button {
            margin-top: 64px;
            background: linear-gradient(to right, #f97316, #ea580c);
            color: white;
            font-weight: bold;
            padding: 16px 40px;
            border-radius: 9999px;
            box-shadow: 0 10px 25px rgba(249, 115, 22, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border: none;
            font-size: 18px;
            z-index: 50;
            animation: bounceSubtle 2s infinite;
        }

        .version-text {
            position: absolute;
            bottom: 24px;
            font-size: 10px;
            color: #93c5fd;
            opacity: 0.6;
            font-family: monospace;
        }

        /* Screens */
        .screen {
            min-height: 100vh;
            width: 100%;
        }

        /* Mode Selection Screen */
        #mode-screen {
            background-color: #f9fafb;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 80px;
        }

        .mode-content {
            width: 100%;
            max-width: 448px;
            margin-top: 32px;
        }

        .mode-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .mode-title {
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
        }

        .mode-subtitle {
            color: #6b7280;
        }

        .mode-buttons {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .mode-button {
            width: 100%;
            background-color: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid #fed7aa;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: none;
            text-align: left;
            transition: all 0.3s ease;
        }

        .mode-button:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transform: scale(1.02);
        }

        .mode-button-left-border {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 8px;
            background-color: #f97316;
        }

        .mode-button-left-border-blue {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 8px;
            background-color: #2563eb;
        }

        .mode-icon {
            padding: 16px;
            border-radius: 9999px;
            transition: all 0.3s ease;
        }

        .mode-icon-orange {
            background-color: #ffedd5;
            color: #ea580c;
        }

        .mode-button:hover .mode-icon-orange {
            background-color: #f97316;
            color: white;
        }

        .mode-icon-blue {
            background-color: #dbeafe;
            color: #2563eb;
        }

        .mode-button:hover .mode-icon-blue {
            background-color: #2563eb;
            color: white;
        }

        .mode-button-content {
            flex: 1;
        }

        .mode-button-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
            transition: color 0.3s ease;
        }

        .mode-button:hover .mode-button-title {
            color: #ea580c;
        }

        .mode-button:hover .mode-button-title.blue {
            color: #2563eb;
        }

        .mode-button-desc {
            font-size: 14px;
            color: #6b7280;
        }

        /* Passcode Screen */
        #passcode-screen {
            min-height: 100vh;
            background-color: #f9fafb;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .passcode-card {
            background-color: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 384px;
            animation: fadeInUp 0.5s ease-out;
        }

        .passcode-title {
            font-size: 20px;
            font-weight: bold;
            color: #1e3a8a;
            margin-bottom: 24px;
            text-align: center;
        }

        .passcode-icon {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .passcode-icon svg {
            color: #3b82f6;
        }

        .passcode-input {
            width: 100%;
            text-align: center;
            font-size: 32px;
            letter-spacing: 0.5em;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 8px;
            outline: none;
            transition: all 0.2s;
        }

        .passcode-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .error-text {
            color: #ef4444;
            font-size: 14px;
            text-align: center;
            margin-bottom: 24px;
            height: 20px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .error-text.show {
            opacity: 1;
        }

        .passcode-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .cancel-button {
            padding: 12px;
            color: #6b7280;
            background-color: #f3f4f6;
            border-radius: 12px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .cancel-button:hover {
            background-color: #e5e7eb;
        }

        .confirm-button {
            padding: 12px;
            color: white;
            background-color: #2563eb;
            border-radius: 12px;
            font-weight: bold;
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.2);
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .confirm-button:hover {
            background-color: #1d4ed8;
        }

        /* Form Selection Screen */
        #form-screen {
            min-height: 100vh;
            background-color: #f9fafb;
            padding: 24px;
        }

        .form-header {
            display: flex;
            align-items: center;
            margin-bottom: 32px;
            padding-top: 16px;
        }

        .back-button {
            padding: 12px;
            margin-right: 16px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .back-button:hover {
            background-color: #f3f4f6;
        }

        .form-header-text h2 {
            font-size: 20px;
            font-weight: bold;
            color: #1e3a8a;
            line-height: 1.2;
        }

        .form-subtitle {
            font-size: 14px;
            color: #6b7280;
            text-transform: capitalize;
        }

        .form-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 448px;
            margin: 0 auto;
        }

        .form-card {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border: 1px solid #f1f5f9;
        }

        .form-card-title {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 16px;
            border-left: 4px solid #f97316;
            padding-left: 12px;
        }

        .role-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .role-button {
            font-size: 14px;
            padding: 10px 12px;
            background-color: #f8fafc;
            color: #475569;
            border-radius: 8px;
            font-weight: 500;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .role-button:hover {
            background-color: #2563eb;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Main Form Screen */
        #form-screen-main {
            min-height: 100vh;
            background-color: #f9fafb;
            padding-bottom: 128px;
        }

        /* Navbar */
        .navbar {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            color: #1e3a8a;
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 20;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 672px;
            margin: 0 auto;
        }

        .nav-button {
            padding: 8px;
            border: none;
            background-color: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-title {
            text-align: center;
        }

        .nav-title-text {
            font-weight: bold;
            font-size: 18px;
            line-height: 1;
        }

        .nav-subtitle {
            font-size: 10px;
            color: #6b7280;
            margin-top: 4px;
            font-weight: 500;
            background-color: #f3f4f6;
            padding: 2px 8px;
            border-radius: 9999px;
            display: inline-block;
        }

        .nav-spacer {
            width: 32px;
        }

        /* Scenario Box */
        .scenario-box {
            background: linear-gradient(to right, #fffbeb, white);
            padding: 20px;
            border-bottom: 1px solid #fed7aa;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .scenario-content {
            max-width: 672px;
            margin: 0 auto;
        }

        .scenario-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .scenario-icon {
            background-color: #ffedd5;
            padding: 8px;
            border-radius: 8px;
            color: #ea580c;
            margin-top: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scenario-text {
            flex: 1;
        }

        .scenario-title {
            font-weight: bold;
            color: #c2410c;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .scenario-details {
            background-color: white;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #fed7aa;
            font-size: 14px;
            color: #374151;
        }

        .scenario-label {
            font-weight: 600;
            color: #1f2937;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #f3f4f6;
        }

        .scenario-group {
            padding: 4px;
        }

        .group-title-green {
            font-size: 12px;
            color: #059669;
            font-weight: bold;
        }

        .group-title-red {
            font-size: 12px;
            color: #dc2626;
            font-weight: bold;
        }

        .sales-scenario {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #f3f4f6;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px 16px;
            font-size: 12px;
        }

        .bold {
            font-weight: bold;
        }

        .ape-info {
            grid-column: span 2;
            margin-top: 4px;
            padding-top: 4px;
            border-top: 1px dashed #d1d5db;
        }

        .scenario-hint {
            font-size: 12px;
            color: #ea580c;
            font-style: italic;
            margin-top: 8px;
        }

        /* Form Container */
        .form-container {
            padding: 16px;
            max-width: 672px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .form-section {
            background-color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
        }

        /* Section Header */
        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            margin-top: 24px;
            padding-bottom: 8px;
            border-bottom-width: 2px;
            border-bottom-style: solid;
        }

        .section-header-blue {
            border-bottom-color: #dbeafe;
        }

        .section-header-green {
            border-bottom-color: #d1fae5;
        }

        .section-header-red {
            border-bottom-color: #fee2e2;
        }

        .section-title {
            color: #1e3a8a;
            font-weight: bold;
            font-size: 18px;
        }

        /* Input Fields */
        .input-container {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 6px;
            margin-left: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-wrapper {
            position: relative;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            transition: all 0.2s;
            outline: none;
            font-weight: 500;
            font-size: 16px;
            background-color: white;
            color: #1f2937;
        }

        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .input-field.readonly {
            background-color: #f8fafc;
            color: #64748b;
            border-color: #e2e8f0;
            cursor: not-allowed;
            user-select: none;
        }

        .input-field.calculated {
            background-color: #eff6ff;
            color: #1e40af;
            border-color: #dbeafe;
            font-weight: bold;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .input-field.highlight {
            border-color: #ef4444;
            background-color: #fef2f2;
            color: #b91c1c;
            animation: shake 0.4s ease-in-out;
        }

        .input-suffix {
            position: absolute;
            right: 12px;
            top: 12px;
            color: #9ca3af;
            pointer-events: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .unit-text {
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
        }

        /* Form Grid */
        .form-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .full-width {
            grid-column: span 2;
        }

        /* Success Section */
        .success-section {
            background-color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-left: 4px solid #10b981;
            position: relative;
            overflow: hidden;
        }

        .success-title {
            color: #059669;
            font-weight: bold;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 10;
            font-size: 18px;
        }

        .success-icon {
            background-color: #d1fae5;
            padding: 6px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Non-Success Section */
        .non-success-section {
            background-color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-left: 4px solid #ef4444;
            position: relative;
            overflow: hidden;
        }

        .non-success-title {
            color: #dc2626;
            font-weight: bold;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 10;
            font-size: 18px;
        }

        .non-success-icon {
            background-color: #fee2e2;
            padding: 6px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Summary Section */
        .summary-section {
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #dbeafe;
        }

        .summary-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Sales Activity Styles */
        .ape-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .ape-row {
            display: flex;
            gap: 16px;
        }

        .ape-field {
            flex: 1;
        }

        /* Funnel Styles */
        .funnel-container {
            position: relative;
        }

        .funnel-line {
            position: absolute;
            left: 26px;
            top: 24px;
            bottom: 24px;
            width: 2px;
            background-color: #e5e7eb;
            z-index: 0;
        }

        .funnel-step {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 10;
            margin-bottom: 8px;
        }

        .step-circle {
            width: 56px;
            height: 56px;
            min-width: 56px;
            border-radius: 12px;
            background-color: #eff6ff;
            border: 2px solid #dbeafe;
            color: #1e40af;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .step-label {
            font-size: 10px;
            color: #60a5fa;
            text-transform: uppercase;
        }

        .step-number {
            font-size: 20px;
            line-height: 1;
        }

        .step-input {
            flex: 1;
        }

        .step-circle-close {
            width: 56px;
            height: 56px;
            min-width: 56px;
            border-radius: 12px;
            background-color: #10b981;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
        }

        .step-label-close {
            font-size: 10px;
            color: #a7f3d0;
            text-transform: uppercase;
        }

        .step-number-close {
            font-size: 20px;
            line-height: 1;
        }

        .conversion-step {
            display: flex;
            margin: 8px 0;
        }

        .conversion-icon {
            width: 56px;
            min-width: 56px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .conversion-icon svg {
            background-color: #ffedd5;
            color: #ea580c;
            border-radius: 9999px;
            padding: 4px;
        }

        .conversion-input {
            flex: 1;
            padding-left: 12px;
        }

        .conversion-box {
            background-color: #fffbeb;
            border-radius: 8px;
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid #fde68a;
        }

        .conversion-label {
            font-size: 12px;
            font-weight: bold;
            color: #c2410c;
            white-space: nowrap;
        }

        .conversion-field {
            width: 100%;
            background-color: white;
            border: 1px solid #fbbf24;
            border-radius: 4px;
            padding: 4px 8px;
            text-align: center;
            font-weight: bold;
            color: #92400e;
            outline: none;
        }

        .conversion-field:focus {
            border-color: #f59e0b;
        }

        .conversion-field.error {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .conversion-unit {
            font-size: 12px;
            color: #f59e0b;
        }

        /* Action Bar */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            border-top: 1px solid #e5e7eb;
            padding: 16px;
            padding-bottom: 24px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
            z-index: 30;
        }

        .action-content {
            max-width: 672px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            gap: 12px;
        }

        .validate-button {
            flex: 1;
            background: linear-gradient(to right, #2563eb, #1d4ed8);
            color: white;
            font-weight: bold;
            padding: 14px 16px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .validate-button:active {
            transform: scale(0.95);
        }

        .save-button {
            flex: 1;
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
            font-weight: bold;
            padding: 14px 16px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .save-button:active {
            transform: scale(0.95);
        }

        .reset-button {
            background-color: #f3f4f6;
            color: #6b7280;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .reset-button:hover {
            background-color: #e5e7eb;
        }

        .button-text {
            font-size: 16px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            z-index: 50;
            animation: fadeIn 0.3s ease-out;
        }

        .modal {
            background-color: white;
            border-radius: 24px;
            padding: 32px;
            width: 100%;
            max-width: 384px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            position: relative;
            overflow: hidden;
            animation: scaleUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
        }

        .modal-header.success {
            background-color: #10b981;
        }

        .modal-header.error {
            background-color: #ef4444;
        }

        .modal-icon {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .success-modal-icon {
            width: 80px;
            height: 80px;
            background-color: #d1fae5;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #059669;
            animation: bounceSubtle 2s infinite;
        }

        .error-modal-icon {
            width: 80px;
            height: 80px;
            background-color: #fee2e2;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dc2626;
            animation: shake 0.4s ease-in-out;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
        }

        .modal-title.success {
            color: #059669;
        }

        .modal-title.error {
            color: #dc2626;
        }

        .modal-text {
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .error-list {
            background-color: #fef2f2;
            padding: 16px;
            border-radius: 12px;
            font-size: 14px;
            color: #991b1b;
            margin-bottom: 24px;
            max-height: 192px;
            overflow-y: auto;
            border: 1px solid #fecaca;
        }

        .error-list-title {
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .error-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .error-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .error-dot {
            min-width: 6px;
            height: 6px;
            border-radius: 9999px;
            background-color: #ef4444;
            margin-top: 4px;
        }

        .modal-button {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            font-weight: bold;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-button:active {
            transform: scale(0.95);
        }

        .modal-button.success {
            background-color: #059669;
        }

        .modal-button.success:hover {
            background-color: #047857;
        }

        .modal-button.error {
            background-color: #1f2937;
        }

        .modal-button.error:hover {
            background-color: #111827;
        }

        /* Icons */
        .icon {
            display: inline-block;
            vertical-align: middle;
        }

        svg {
            display: block;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .form-grid-2 {
                grid-template-columns: 1fr;
            }
            
            .full-width {
                grid-column: span 1;
            }
            
            .ape-row {
                flex-direction: column;
                gap: 8px;
            }
            
            .role-grid {
                grid-template-columns: 1fr;
            }
            
            .mode-button {
                padding: 16px;
                gap: 12px;
            }
            
            .mode-button-title {
                font-size: 18px;
            }
            
            .mode-button-desc {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen">
        <div class="loading-bg-circle1"></div>
        <div class="loading-bg-circle2"></div>
        
        <div class="loading-content">
            <div class="logo-container">
                <div class="logo-text">ttb</div>
            </div>
            
            <h1 class="loading-title">Performance Planner</h1>
            <p class="loading-subtitle">Training & Calculation System</p>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <p class="progress-text">Initializing System...</p>
            </div>

            <button id="start-button" class="start-button">
                <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <span>เข้าสู่ระบบ</span>
            </button>
        </div>
        
        <div class="version-text">v2.0.1 Production (Hotfix) | ttb Training Team</div>
    </div>

    <!-- Mode Selection Screen -->
    <div id="mode-screen" class="screen hidden">
        <div class="mode-content animate-fade-in">
            <div class="mode-header">
                <h2 class="mode-title">เลือกโหมดการทำงาน</h2>
                <p class="mode-subtitle">Select working mode</p>
            </div>
            
            <div class="mode-buttons">
                <button id="training-mode" class="mode-button">
                    <div class="mode-button-left-border"></div>
                    <div class="mode-icon mode-icon-orange">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                    </div>
                    <div class="mode-button-content">
                        <h3 class="mode-button-title">Training Mode</h3>
                        <p class="mode-button-desc">ฝึกคำนวณและกรอกฟอร์ม (สุ่มโจทย์)</p>
                    </div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="transform: rotate(-90deg); color: #d1d5db;">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>

                <button id="working-mode" class="mode-button">
                    <div class="mode-button-left-border-blue"></div>
                    <div class="mode-icon mode-icon-blue">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                            <line x1="8" y1="6" x2="16" y2="6"></line>
                            <line x1="8" y1="10" x2="16" y2="10"></line>
                            <line x1="8" y1="14" x2="16" y2="14"></line>
                            <line x1="8" y1="18" x2="16" y2="18"></line>
                        </svg>
                    </div>
                    <div class="mode-button-content">
                        <h3 class="mode-button-title blue">Working Mode</h3>
                        <p class="mode-button-desc">เครื่องมือช่วยคำนวณ (Passcode)</p>
                    </div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="transform: rotate(-90deg); color: #d1d5db;">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Passcode Screen -->
    <div id="passcode-screen" class="screen hidden">
        <div class="passcode-card">
            <h2 class="passcode-title">Enter Passcode</h2>
            <div class="passcode-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>
            <input id="passcode-input" type="password" class="passcode-input" placeholder="•••••" maxlength="5" autofocus>
            <p id="passcode-error" class="error-text"></p>
            <div class="passcode-buttons">
                <button id="cancel-passcode" class="cancel-button">ยกเลิก</button>
                <button id="confirm-passcode" class="confirm-button">ยืนยัน</button>
            </div>
        </div>
    </div>

    <!-- Form Selection Screen -->
    <div id="form-screen" class="screen hidden">
        <div class="form-header">
            <button id="back-to-menu" class="back-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
            </button>
            <div class="form-header-text">
                <h2>เลือกแบบฟอร์ม</h2>
                <span id="mode-indicator" class="form-subtitle">Training Mode</span>
            </div>
        </div>
        
        <div class="form-grid">
            <!-- Key Driver Form -->
            <div class="form-card">
                <h3 class="form-card-title">Key Driver</h3>
                <div class="role-grid">
                    <button class="role-button" data-form="KeyDriver" data-role="IS">IS</button>
                    <button class="role-button" data-form="KeyDriver" data-role="IA">IA</button>
                    <button class="role-button" data-form="KeyDriver" data-role="LA">LA</button>
                    <button class="role-button" data-form="KeyDriver" data-role="IS Commercial">IS Commercial</button>
                </div>
            </div>
            
            <!-- Action Plan Form -->
            <div class="form-card">
                <h3 class="form-card-title">Action Plan</h3>
                <div class="role-grid">
                    <button class="role-button" data-form="ActionPlan" data-role="IS">IS</button>
                    <button class="role-button" data-form="ActionPlan" data-role="IA">IA</button>
                    <button class="role-button" data-form="ActionPlan" data-role="LA">LA</button>
                    <button class="role-button" data-form="ActionPlan" data-role="IS Commercial">IS Commercial</button>
                </div>
            </div>
            
            <!-- Sales Activity Form -->
            <div class="form-card">
                <h3 class="form-card-title">Sales Activity</h3>
                <div class="role-grid">
                    <button class="role-button" data-form="SalesActivity" data-role="IS">IS</button>
                    <button class="role-button" data-form="SalesActivity" data-role="IA">IA</button>
                    <button class="role-button" data-form="SalesActivity" data-role="LA">LA</button>
                    <button class="role-button" data-form="SalesActivity" data-role="IS Commercial">IS Commercial</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Form Screen -->
    <div id="form-screen-main" class="screen hidden">
        <!-- Navbar -->
        <div class="navbar">
            <div class="nav-content">
                <button id="back-to-forms" class="nav-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>
                <div class="nav-title">
                    <h1 id="form-title" class="nav-title-text">Key Driver</h1>
                    <p id="form-subtitle" class="nav-subtitle">IA • Training</p>
                </div>
                <div class="nav-spacer"></div>
            </div>
        </div>

        <!-- Scenario Box (Only for Training) -->
        <div id="scenario-box" class="scenario-box hidden">
            <div class="scenario-content">
                <div class="scenario-header">
                    <div class="scenario-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                    </div>
                    <div class="scenario-text">
                        <h3 class="scenario-title">Scenario / โจทย์</h3>
                        <div id="scenario-details" class="scenario-details">
                            <!-- Scenario details will be filled by JavaScript -->
                        </div>
                        <p class="scenario-hint">* กรุณากรอกข้อมูลในช่องว่างให้ถูกต้องตามโจทย์</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Form Content -->
        <div class="form-container">
            <!-- Basic Info Section -->
            <div class="form-section">
                <div class="section-header section-header-blue">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                    <h3 class="section-title">ข้อมูลพื้นฐาน</h3>
                </div>
                <div class="form-grid-2">
                    <div class="input-container">
                        <label class="input-label">ชื่อพนักงาน</label>
                        <div class="input-wrapper">
                            <input id="name" type="text" class="input-field" placeholder="ชื่อ-สกุล">
                        </div>
                    </div>
                    <div class="input-container">
                        <label class="input-label">Zone</label>
                        <div class="input-wrapper">
                            <input id="zone" type="text" class="input-field" placeholder="Zone">
                        </div>
                    </div>
                    <div class="input-container full-width">
                        <label class="input-label">Target (เป้าหมาย)</label>
                        <div class="input-wrapper">
                            <input id="target" type="number" class="input-field readonly" readonly>
                            <div class="input-suffix">
                                <span class="unit-text">บาท</span>
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.5;">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Driver / Action Plan Form -->
            <div id="key-driver-form">
                <!-- Success Group -->
                <div class="success-section">
                    <h3 class="success-title">
                        <div class="success-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </div>
                        กลุ่ม Success
                    </h3>
                    <div class="form-grid-2">
                        <div class="input-container">
                            <label class="input-label">จำนวนคน</label>
                            <div class="input-wrapper">
                                <input id="success-count" type="number" class="input-field readonly" readonly>
                                <div class="input-suffix">
                                    <span class="unit-text">คน</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">% ของคนทั้งหมด</label>
                            <div class="input-wrapper">
                                <input id="success-percent" type="number" class="input-field">
                                <div class="input-suffix">
                                    <span class="unit-text">%</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">APE / คน</label>
                            <div class="input-wrapper">
                                <input id="success-ape-per-head" type="number" class="input-field readonly" readonly>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">Total APE (Success)</label>
                            <div class="input-wrapper">
                                <input id="success-total-ape" type="number" class="input-field">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Non-Success Group -->
                <div class="non-success-section">
                    <h3 class="non-success-title">
                        <div class="non-success-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                        </div>
                        กลุ่ม Non-Success
                    </h3>
                    <div class="form-grid-2">
                        <div class="input-container">
                            <label class="input-label">จำนวนคน</label>
                            <div class="input-wrapper">
                                <input id="nonsuccess-count" type="number" class="input-field readonly" readonly>
                                <div class="input-suffix">
                                    <span class="unit-text">คน</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">% ของคนทั้งหมด</label>
                            <div class="input-wrapper">
                                <input id="nonsuccess-percent" type="number" class="input-field">
                                <div class="input-suffix">
                                    <span class="unit-text">%</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">APE / คน</label>
                            <div class="input-wrapper">
                                <input id="nonsuccess-ape-per-head" type="number" class="input-field readonly" readonly>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">Total APE (Non-Success)</label>
                            <div class="input-wrapper">
                                <input id="nonsuccess-total-ape" type="number" class="input-field">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary -->
                <div class="summary-section">
                    <div class="section-header section-header-blue">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                        </svg>
                        <h3 class="section-title">สรุปผลรวม</h3>
                    </div>
                    <div class="summary-content">
                        <div class="input-container">
                            <label class="input-label">Total APE (รวมทั้งหมด)</label>
                            <div class="input-wrapper">
                                <input id="total-ape" type="number" class="input-field">
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">% ACH Target</label>
                            <div class="input-wrapper">
                                <input id="ach-target-percent" type="number" class="input-field">
                                <div class="input-suffix">
                                    <span class="unit-text">%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Activity Form -->
            <div id="sales-activity-form" class="hidden">
                <!-- APE Results -->
                <div class="form-section">
                    <div class="section-header section-header-blue">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                        </svg>
                        <h3 class="section-title">ผลลัพธ์ (APE)</h3>
                    </div>
                    <div class="ape-grid">
                        <div class="ape-row">
                            <div class="ape-field">
                                <div class="input-container">
                                    <label class="input-label">APE Issue</label>
                                    <div class="input-wrapper">
                                        <input id="ape-issue" type="number" class="input-field readonly" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="ape-field">
                                <div class="input-container">
                                    <label class="input-label">APE Submit</label>
                                    <div class="input-wrapper">
                                        <input id="ape-submit" type="number" class="input-field readonly" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">Issue Rate (%)</label>
                            <div class="input-wrapper">
                                <input id="issue-rate" type="number" class="input-field">
                                <div class="input-suffix">
                                    <span class="unit-text">%</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-container">
                            <label class="input-label">เบี้ยฯ เฉลี่ย / Case</label>
                            <div class="input-wrapper">
                                <input id="avg-premium" type="number" class="input-field readonly" readonly>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sales Funnel -->
                <div class="form-section">
                    <div class="section-header section-header-blue">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <polyline points="1 20 1 14 7 14"></polyline>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        <h3 class="section-title">Sales Funnel Conversion</h3>
                    </div>
                    <div class="funnel-container">
                        <div class="funnel-line"></div>
                        
                        <!-- Step 1: Lead -->
                        <div class="funnel-step">
                            <div class="step-circle">
                                <span class="step-label">Step</span>
                                <span class="step-number">1</span>
                            </div>
                            <div class="step-input">
                                <div class="input-container">
                                    <label class="input-label">Lead (ราย)</label>
                                    <div class="input-wrapper">
                                        <input id="leads" type="number" class="input-field readonly" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conversion 1-2 -->
                        <div class="conversion-step">
                            <div class="conversion-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </div>
                            <div class="conversion-input">
                                <div class="conversion-box">
                                    <span class="conversion-label">Conv. Rate</span>
                                    <input id="conv-lead-meet" type="number" class="conversion-field" placeholder="%">
                                    <span class="conversion-unit">%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 2: Meet -->
                        <div class="funnel-step">
                            <div class="step-circle">
                                <span class="step-label">Step</span>
                                <span class="step-number">2</span>
                            </div>
                            <div class="step-input">
                                <div class="input-container">
                                    <label class="input-label">ได้พบ (ราย)</label>
                                    <div class="input-wrapper">
                                        <input id="meets" type="number" class="input-field readonly" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conversion 2-3 -->
                        <div class="conversion-step">
                            <div class="conversion-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </div>
                            <div class="conversion-input">
                                <div class="conversion-box">
                                    <span class="conversion-label">Conv. Rate</span>
                                    <input id="conv-meet-present" type="number" class="conversion-field" placeholder="%">
                                    <span class="conversion-unit">%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 3: Present -->
                        <div class="funnel-step">
                            <div class="step-circle">
                                <span class="step-label">Step</span>
                                <span class="step-number">3</span>
                            </div>
                            <div class="step-input">
                                <div class="input-container">
                                    <label class="input-label">นำเสนอ (ราย)</label>
                                    <div class="input-wrapper">
                                        <input id="presents" type="number" class="input-field readonly" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conversion 3-4 -->
                        <div class="conversion-step">
                            <div class="conversion-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </div>
                            <div class="conversion-input">
                                <div class="conversion-box">
                                    <span class="conversion-label">Closing Rate</span>
                                    <input id="conv-present-close" type="number" class="conversion-field" placeholder="%">
                                    <span class="conversion-unit">%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 4: Close -->
                        <div class="funnel-step">
                            <div class="step-circle-close">
                                <span class="step-label-close">Step</span>
                                <span class="step-number-close">4</span>
                            </div>
                            <div class="step-input">
                                <div class="input-container">
                                    <label class="input-label">ปิดการขาย (ราย)</label>
                                    <div class="input-wrapper">
                                        <input id="closes" type="number" class="input-field readonly" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <div class="action-content">
                <button id="validate-button" class="validate-button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <span class="button-text">ตรวจคำตอบ</span>
                </button>
                <button id="save-button" class="save-button hidden">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    <span class="button-text">บันทึก</span>
                </button>
                <button id="reset-button" class="reset-button" title="Reset">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Validation Modal -->
    <div id="validation-modal" class="modal-overlay hidden">
        <div class="modal">
            <div id="modal-header" class="modal-header success"></div>
            <div class="modal-icon">
                <div id="success-modal-icon" class="success-modal-icon hidden">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                </div>
                <div id="error-modal-icon" class="error-modal-icon hidden">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                </div>
            </div>
            <h3 id="modal-title" class="modal-title success">ยอดเยี่ยม! ถูกต้อง</h3>
            <p id="modal-text" class="modal-text">คุณคำนวณได้อย่างแม่นยำ</p>
            <div id="error-list" class="error-list hidden">
                <p class="error-list-title">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                    จุดที่ต้องแก้ไข:
                </p>
                <ul id="error-items" class="error-items"></ul>
            </div>
            <button id="modal-button" class="modal-button success">ทำข้อต่อไป</button>
        </div>
    </div>

    <script>
        // Constants
        const FORM_TYPES = {
            KEY_DRIVER: 'KeyDriver',
            ACTION_PLAN: 'ActionPlan',
            SALES_ACTIVITY: 'SalesActivity'
        };

        const ROLES = ['IS', 'IA', 'LA', 'IS Commercial'];

        // Generate mock scenarios
        function generateScenarios() {
            const scenarios = [];
            for (let i = 0; i < 10; i++) {
                const target = Math.round((Math.random() * 5000000) + 1000000);
                const successCount = Math.floor(Math.random() * 5) + 1;
                const nonSuccessCount = Math.floor(Math.random() * 5) + 1;
                const successAPE = Math.round((Math.random() * 100000) + 50000);
                const nonSuccessAPE = Math.round((Math.random() * 30000) + 10000);
                
                const leads = Math.floor(Math.random() * 50) + 20;
                const meets = Math.floor(leads * (0.6 + Math.random() * 0.2)); 
                const presents = Math.floor(meets * (0.7 + Math.random() * 0.2));
                const closes = Math.max(1, Math.floor(presents * (0.5 + Math.random() * 0.3))); 
                
                const avgPremium = Math.round((Math.random() * 20000) + 10000);
                const apeSubmit = closes * avgPremium;
                const issueRate = 0.8 + (Math.random() * 0.15);
                const apeIssue = Math.floor(apeSubmit * issueRate);

                scenarios.push({
                    id: i,
                    target,
                    successCount,
                    nonSuccessCount,
                    successAPE, 
                    nonSuccessAPE,
                    leads,
                    meets,
                    presents,
                    closes,
                    avgPremium,
                    apeSubmit,
                    apeIssue
                });
            }
            return scenarios;
        }

        const MOCK_SCENARIOS = generateScenarios();

        // State
        let currentScreen = 'loading';
        let currentMode = 'training';
        let currentFormType = FORM_TYPES.KEY_DRIVER;
        let currentRole = 'IA';
        let currentScenario = null;
        let formData = {};
        let validationResult = null;

        // DOM Elements
        const screens = {
            loading: document.getElementById('loading-screen'),
            mode: document.getElementById('mode-screen'),
            passcode: document.getElementById('passcode-screen'),
            form: document.getElementById('form-screen'),
            formMain: document.getElementById('form-screen-main')
        };

        // Input Elements
        const inputElements = {
            name: document.getElementById('name'),
            zone: document.getElementById('zone'),
            target: document.getElementById('target'),
            
            // Key Driver / Action Plan
            successCount: document.getElementById('success-count'),
            successPercent: document.getElementById('success-percent'),
            successApePerHead: document.getElementById('success-ape-per-head'),
            successTotalApe: document.getElementById('success-total-ape'),
            
            nonsuccessCount: document.getElementById('nonsuccess-count'),
            nonsuccessPercent: document.getElementById('nonsuccess-percent'),
            nonsuccessApePerHead: document.getElementById('nonsuccess-ape-per-head'),
            nonsuccessTotalApe: document.getElementById('nonsuccess-total-ape'),
            
            totalApe: document.getElementById('total-ape'),
            achTargetPercent: document.getElementById('ach-target-percent'),
            
            // Sales Activity
            apeIssue: document.getElementById('ape-issue'),
            apeSubmit: document.getElementById('ape-submit'),
            issueRate: document.getElementById('issue-rate'),
            avgPremium: document.getElementById('avg-premium'),
            
            leads: document.getElementById('leads'),
            meets: document.getElementById('meets'),
            presents: document.getElementById('presents'),
            closes: document.getElementById('closes'),
            
            convLeadMeet: document.getElementById('conv-lead-meet'),
            convMeetPresent: document.getElementById('conv-meet-present'),
            convPresentClose: document.getElementById('conv-present-close')
        };

        // Form Containers
        const keyDriverForm = document.getElementById('key-driver-form');
        const salesActivityForm = document.getElementById('sales-activity-form');

        // Buttons
        const startButton = document.getElementById('start-button');
        const trainingModeButton = document.getElementById('training-mode');
        const workingModeButton = document.getElementById('working-mode');
        const cancelPasscodeButton = document.getElementById('cancel-passcode');
        const confirmPasscodeButton = document.getElementById('confirm-passcode');
        const backToMenuButton = document.getElementById('back-to-menu');
        const backToFormsButton = document.getElementById('back-to-forms');
        const validateButton = document.getElementById('validate-button');
        const saveButton = document.getElementById('save-button');
        const resetButton = document.getElementById('reset-button');
        const roleButtons = document.querySelectorAll('.role-button');
        const passcodeInput = document.getElementById('passcode-input');
        const passcodeError = document.getElementById('passcode-error');

        // Modal Elements
        const validationModal = document.getElementById('validation-modal');
        const modalHeader = document.getElementById('modal-header');
        const successModalIcon = document.getElementById('success-modal-icon');
        const errorModalIcon = document.getElementById('error-modal-icon');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const errorList = document.getElementById('error-list');
        const errorItems = document.getElementById('error-items');
        const modalButton = document.getElementById('modal-button');

        // Scenario Elements
        const scenarioBox = document.getElementById('scenario-box');
        const scenarioDetails = document.getElementById('scenario-details');
        const formTitle = document.getElementById('form-title');
        const formSubtitle = document.getElementById('form-subtitle');
        const modeIndicator = document.getElementById('mode-indicator');

        // Screen Management
        function showScreen(screenName) {
            // Hide all screens
            Object.values(screens).forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Show the requested screen
            screens[screenName].classList.remove('hidden');
            currentScreen = screenName;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize
        function init() {
            // Set up event listeners
            startButton.addEventListener('click', () => {
                showScreen('mode');
            });

            trainingModeButton.addEventListener('click', () => {
                currentMode = 'training';
                modeIndicator.textContent = 'Training Mode';
                showScreen('form');
            });

            workingModeButton.addEventListener('click', () => {
                showScreen('passcode');
            });

            cancelPasscodeButton.addEventListener('click', () => {
                showScreen('mode');
            });

            confirmPasscodeButton.addEventListener('click', () => {
                const passcode = passcodeInput.value;
                if (passcode === '54321') {
                    currentMode = 'calculator';
                    modeIndicator.textContent = 'Working Mode';
                    passcodeInput.value = '';
                    passcodeError.textContent = '';
                    passcodeError.classList.remove('show');
                    showScreen('form');
                } else {
                    passcodeError.textContent = 'รหัสผ่านไม่ถูกต้อง';
                    passcodeError.classList.add('show');
                    passcodeInput.value = '';
                    passcodeInput.focus();
                }
            });

            backToMenuButton.addEventListener('click', () => {
                showScreen('mode');
            });

            backToFormsButton.addEventListener('click', () => {
                showScreen('form');
            });

            // Role button click handlers
            roleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const formType = button.getAttribute('data-form');
                    const role = button.getAttribute('data-role');
                    startForm(formType, role);
                });
            });

            // Input change handlers
            Object.keys(inputElements).forEach(key => {
                const element = inputElements[key];
                if (element) {
                    element.addEventListener('input', (e) => {
                        handleInputChange(key, e.target.value);
                    });
                }
            });

            // Conversion rate input handlers
            if (inputElements.convLeadMeet) {
                inputElements.convLeadMeet.addEventListener('input', (e) => {
                    handleInputChange('conv_lead_meet', e.target.value);
                });
            }

            if (inputElements.convMeetPresent) {
                inputElements.convMeetPresent.addEventListener('input', (e) => {
                    handleInputChange('conv_meet_present', e.target.value);
                });
            }

            if (inputElements.convPresentClose) {
                inputElements.convPresentClose.addEventListener('input', (e) => {
                    handleInputChange('conv_present_close', e.target.value);
                });
            }

            // Action buttons
            validateButton.addEventListener('click', validateTraining);
            saveButton.addEventListener('click', () => {
                alert("ข้อมูลถูกบันทึกเรียบร้อยแล้ว (Demo)");
            });

            resetButton.addEventListener('click', () => {
                if (confirm('ต้องการล้างค่าทั้งหมด?')) {
                    resetForm();
                }
            });

            modalButton.addEventListener('click', () => {
                validationModal.classList.add('hidden');
                validationResult = null;
            });

            // Set up form visibility
            updateFormVisibility();
            
            // Simulate loading progress
            simulateLoading();
        }

        // Simulate loading progress
        function simulateLoading() {
            let progress = 0;
            const progressFill = document.querySelector('.progress-fill');
            const progressText = document.querySelector('.progress-text');
            
            const interval = setInterval(() => {
                progress += 10;
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `Initializing System... ${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    startButton.disabled = false;
                    startButton.style.opacity = '1';
                }
            }, 100);
        }

        // Start a new form
        function startForm(formType, role) {
            currentFormType = formType;
            currentRole = role;
            validationResult = null;
            formData = {};
            
            // Update UI
            formTitle.textContent = formType.replace(/([A-Z])/g, ' $1').trim();
            formSubtitle.textContent = `${role} • ${currentMode === 'training' ? 'Training' : 'Calculator'}`;
            
            // Show/hide scenario box
            if (currentMode === 'training') {
                const newScenario = MOCK_SCENARIOS[Math.floor(Math.random() * MOCK_SCENARIOS.length)];
                currentScenario = newScenario;
                scenarioBox.classList.remove('hidden');
                
                // Update scenario details
                updateScenarioDetails(newScenario, formType);
                
                // Set initial form data
                formData = {
                    name: "Test User",
                    zone: "BKK-1",
                    rh: "Manager A",
                    target: newScenario.target,
                    success_count: newScenario.successCount,
                    success_ape_per_head: newScenario.successAPE,
                    nonsuccess_count: newScenario.nonSuccessCount,
                    nonsuccess_ape_per_head: newScenario.nonSuccessAPE,
                    leads: newScenario.leads,
                    meets: newScenario.meets,
                    presents: newScenario.presents,
                    closes: newScenario.closes,
                    ape_issue: newScenario.apeIssue,
                    ape_submit: newScenario.apeSubmit,
                };
                
                // Set readonly for training mode
                setInputReadonly(true);
                
                // Set initial values
                updateInputValues();
            } else {
                currentScenario = null;
                scenarioBox.classList.add('hidden');
                formData = {};
                resetForm();
                setInputReadonly(false);
            }
            
            // Update form visibility
            updateFormVisibility();
            
            // Show/hide action buttons
            if (currentMode === 'training') {
                validateButton.classList.remove('hidden');
                saveButton.classList.add('hidden');
            } else {
                validateButton.classList.add('hidden');
                saveButton.classList.remove('hidden');
            }
            
            // Show the main form screen
            showScreen('formMain');
        }

        // Update scenario details display
        function updateScenarioDetails(scenario, formType) {
            let html = '';
            
            if (formType === FORM_TYPES.KEY_DRIVER || formType === FORM_TYPES.ACTION_PLAN) {
                html = `
                    <p><span class="scenario-label">Target:</span> ${scenario.target.toLocaleString()}</p>
                    <div class="scenario-grid">
                        <div class="scenario-group">
                            <p class="group-title-green">Success Group</p>
                            <p>${scenario.successCount} คน</p>
                            <p>APE: ${scenario.successAPE.toLocaleString()}/คน</p>
                        </div>
                        <div class="scenario-group">
                            <p class="group-title-red">Non-Success Group</p>
                            <p>${scenario.nonSuccessCount} คน</p>
                            <p>APE: ${scenario.nonSuccessAPE.toLocaleString()}/คน</p>
                        </div>
                    </div>
                `;
            } else if (formType === FORM_TYPES.SALES_ACTIVITY) {
                html = `
                    <p><span class="scenario-label">Target:</span> ${scenario.target.toLocaleString()}</p>
                    <div class="sales-scenario">
                        <p>Lead: <span class="bold">${scenario.leads}</span></p>
                        <p>Meet: <span class="bold">${scenario.meets}</span></p>
                        <p>Present: <span class="bold">${scenario.presents}</span></p>
                        <p>Close: <span class="bold">${scenario.closes}</span></p>
                        <p class="ape-info">
                            APE Issue: ${scenario.apeIssue.toLocaleString()} | Submit: ${scenario.apeSubmit.toLocaleString()}
                        </p>
                    </div>
                `;
            }
            
            scenarioDetails.innerHTML = html;
        }

        // Update form visibility based on form type
        function updateFormVisibility() {
            if (currentFormType === FORM_TYPES.SALES_ACTIVITY) {
                keyDriverForm.classList.add('hidden');
                salesActivityForm.classList.remove('hidden');
            } else {
                keyDriverForm.classList.remove('hidden');
                salesActivityForm.classList.add('hidden');
            }
        }

        // Set input readonly status
        function setInputReadonly(isReadonly) {
            const trainingReadonlyFields = ['target', 'success-count', 'success-ape-per-head', 
                'nonsuccess-count', 'nonsuccess-ape-per-head', 'leads', 'meets', 
                'presents', 'closes', 'ape-issue', 'ape-submit'];
            
            const calculatorReadonlyFields = ['success-percent', 'success-total-ape', 
                'nonsuccess-percent', 'nonsuccess-total-ape', 'total-ape', 'ach-target-percent',
                'issue-rate', 'conv-lead-meet', 'conv-meet-present', 'conv-present-close'];
            
            trainingReadonlyFields.forEach(fieldId => {
                const element = inputElements[fieldId];
                if (element) {
                    element.classList.toggle('readonly', isReadonly);
                    element.readOnly = isReadonly;
                }
            });
            
            if (currentMode === 'calculator') {
                calculatorReadonlyFields.forEach(fieldId => {
                    const element = inputElements[fieldId];
                    if (element) {
                        element.classList.add('calculated');
                        element.readOnly = true;
                    }
                });
                
                // Set avg-premium based on mode
                if (inputElements.avgPremium) {
                    if (currentFormType === FORM_TYPES.SALES_ACTIVITY) {
                        inputElements.avgPremium.classList.add('calculated');
                        inputElements.avgPremium.readOnly = true;
                    } else {
                        inputElements.avgPremium.classList.remove('calculated');
                        inputElements.avgPremium.readOnly = false;
                    }
                }
            } else {
                calculatorReadonlyFields.forEach(fieldId => {
                    const element = inputElements[fieldId];
                    if (element) {
                        element.classList.remove('calculated');
                        element.readOnly = false;
                    }
                });
            }
        }

        // Update input values from formData
        function updateInputValues() {
            Object.keys(formData).forEach(key => {
                const fieldMap = {
                    'name': 'name',
                    'zone': 'zone',
                    'target': 'target',
                    'success_count': 'success-count',
                    'success_ape_per_head': 'success-ape-per-head',
                    'nonsuccess_count': 'nonsuccess-count',
                    'nonsuccess_ape_per_head': 'nonsuccess-ape-per-head',
                    'leads': 'leads',
                    'meets': 'meets',
                    'presents': 'presents',
                    'closes': 'closes',
                    'ape_issue': 'ape-issue',
                    'ape_submit': 'ape-submit',
                    'success_total_ape': 'success-total-ape',
                    'nonsuccess_total_ape': 'nonsuccess-total-ape',
                    'success_percent': 'success-percent',
                    'nonsuccess_percent': 'nonsuccess-percent',
                    'total_ape': 'total-ape',
                    'ach_target_percent': 'ach-target-percent',
                    'conv_lead_meet': 'conv-lead-meet',
                    'conv_meet_present': 'conv-meet-present',
                    'conv_present_close': 'conv-present-close',
                    'issue_rate': 'issue-rate',
                    'avg_premium': 'avg-premium'
                };
                
                const elementId = fieldMap[key];
                if (elementId && inputElements[elementId]) {
                    inputElements[elementId].value = formData[key] || '';
                }
            });
        }

        // Handle input changes
        function handleInputChange(field, value) {
            formData[field] = value;
            
            if (currentMode === 'calculator') {
                const safeFloat = (v) => parseFloat(String(v).replace(/,/g,'')) || 0;
                
                if (currentFormType === FORM_TYPES.KEY_DRIVER || currentFormType === FORM_TYPES.ACTION_PLAN) {
                    const s_count = safeFloat(formData['success-count']);
                    const s_ape = safeFloat(formData['success-ape-per-head']);
                    const n_count = safeFloat(formData['nonsuccess-count']);
                    const n_ape = safeFloat(formData['nonsuccess-ape-per-head']);
                    const target = safeFloat(formData.target);

                    const s_total = s_count * s_ape;
                    const n_total = n_count * n_ape;
                    const total_ape = s_total + n_total;
                    const total_people = s_count + n_count;
                    const s_percent = total_people > 0 ? (s_count / total_people) * 100 : 0;
                    const n_percent = total_people > 0 ? (n_count / total_people) * 100 : 0;
                    const ach = target > 0 ? (total_ape / target) * 100 : 0;

                    formData['success-total-ape'] = s_total > 0 ? s_total : '';
                    formData['nonsuccess-total-ape'] = n_total > 0 ? n_total : '';
                    formData['success-percent'] = s_percent > 0 ? s_percent.toFixed(1) : '';
                    formData['nonsuccess-percent'] = n_percent > 0 ? n_percent.toFixed(1) : '';
                    formData['total-ape'] = total_ape > 0 ? total_ape : '';
                    formData['ach-target-percent'] = ach > 0 ? ach.toFixed(2) : '';
                    
                    updateInputValues();
                }

                if (currentFormType === FORM_TYPES.SALES_ACTIVITY) {
                    const leads = safeFloat(formData.leads);
                    const meets = safeFloat(formData.meets);
                    const presents = safeFloat(formData.presents);
                    const closes = safeFloat(formData.closes);
                    const ape_issue = safeFloat(formData['ape-issue']);
                    const ape_submit = safeFloat(formData['ape-submit']);

                    const conv_lead_meet = leads > 0 ? (meets / leads) * 100 : 0;
                    const conv_meet_present = meets > 0 ? (presents / meets) * 100 : 0;
                    const conv_present_close = presents > 0 ? (closes / presents) * 100 : 0;
                    const issue_rate = ape_submit > 0 ? (ape_issue / ape_submit) * 100 : 0;
                    const avg_prem = closes > 0 ? (ape_submit / closes) : 0;

                    formData['conv-lead-meet'] = conv_lead_meet > 0 ? conv_lead_meet.toFixed(0) : '';
                    formData['conv-meet-present'] = conv_meet_present > 0 ? conv_meet_present.toFixed(0) : '';
                    formData['conv-present-close'] = conv_present_close > 0 ? conv_present_close.toFixed(0) : '';
                    formData['issue-rate'] = issue_rate > 0 ? issue_rate.toFixed(1) : '';
                    formData['avg-premium'] = avg_prem > 0 ? avg_prem.toFixed(0) : '';
                    
                    updateInputValues();
                }
            }
        }

        // Reset form
        function resetForm() {
            Object.values(inputElements).forEach(element => {
                if (element) {
                    element.value = '';
                    element.classList.remove('highlight');
                    element.classList.remove('error');
                }
            });
            
            formData = {};
        }

        // Validate training mode
        function validateTraining() {
            const safeFloat = (v) => parseFloat(String(v).replace(/,/g,'')) || 0;
            let errors = {};
            let isCorrect = true;

            const isClose = (a, b) => Math.abs(a - b) < 0.5;

            if (currentFormType === FORM_TYPES.KEY_DRIVER || currentFormType === FORM_TYPES.ACTION_PLAN) {
                const s_total = safeFloat(formData['success-count']) * safeFloat(formData['success-ape-per-head']);
                const n_total = safeFloat(formData['nonsuccess-count']) * safeFloat(formData['nonsuccess-ape-per-head']);
                const total_ape = s_total + n_total;
                const total_people = safeFloat(formData['success-count']) + safeFloat(formData['nonsuccess-count']);
                const s_perc = (safeFloat(formData['success-count']) / total_people) * 100;
                const ach = (total_ape / safeFloat(formData.target)) * 100;

                if (!isClose(safeFloat(formData['success-total-ape']), s_total)) {
                    errors.success_total_ape = `ที่ถูกต้อง: ${s_total.toLocaleString()}`;
                    inputElements['success-total-ape'].classList.add('highlight');
                }

                if (!isClose(safeFloat(formData['nonsuccess-total-ape']), n_total)) {
                    errors.nonsuccess_total_ape = `ที่ถูกต้อง: ${n_total.toLocaleString()}`;
                    inputElements['nonsuccess-total-ape'].classList.add('highlight');
                }

                if (!isClose(safeFloat(formData['total-ape']), total_ape)) {
                    errors.total_ape = `ที่ถูกต้อง: ${total_ape.toLocaleString()}`;
                    inputElements['total-ape'].classList.add('highlight');
                }

                if (!isClose(safeFloat(formData['success-percent']), s_perc)) {
                    errors.success_percent = `ที่ถูกต้อง: ${s_perc.toFixed(1)}%`;
                    inputElements['success-percent'].classList.add('highlight');
                }

                if (!isClose(safeFloat(formData['ach-target-percent']), ach)) {
                    errors.ach_target_percent = `ที่ถูกต้อง: ${ach.toFixed(2)}%`;
                    inputElements['ach-target-percent'].classList.add('highlight');
                }
            }

            if (currentFormType === FORM_TYPES.SALES_ACTIVITY) {
                const c1 = (safeFloat(formData.meets) / safeFloat(formData.leads)) * 100;
                const c2 = (safeFloat(formData.presents) / safeFloat(formData.meets)) * 100;
                const c3 = (safeFloat(formData.closes) / safeFloat(formData.presents)) * 100;
                const issue_rate = (safeFloat(formData['ape-issue']) / safeFloat(formData['ape-submit'])) * 100;

                if (!isClose(safeFloat(formData['conv-lead-meet']), c1)) {
                    errors.conv_lead_meet = `ที่ถูกต้อง: ${c1.toFixed(0)}%`;
                    inputElements['conv-lead-meet'].classList.add('error');
                }

                if (!isClose(safeFloat(formData['conv-meet-present']), c2)) {
                    errors.conv_meet_present = `ที่ถูกต้อง: ${c2.toFixed(0)}%`;
                    inputElements['conv-meet-present'].classList.add('error');
                }

                if (!isClose(safeFloat(formData['conv-present-close']), c3)) {
                    errors.conv_present_close = `ที่ถูกต้อง: ${c3.toFixed(0)}%`;
                    inputElements['conv-present-close'].classList.add('error');
                }

                if (!isClose(safeFloat(formData['issue-rate']), issue_rate)) {
                    errors.issue_rate = `ที่ถูกต้อง: ${issue_rate.toFixed(1)}%`;
                    inputElements['issue-rate'].classList.add('highlight');
                }
            }

            if (Object.keys(errors).length > 0) isCorrect = false;
            validationResult = { isCorrect, errors };
            
            showValidationModal();
        }

        // Show validation modal
        function showValidationModal() {
            if (!validationResult) return;
            
            // Clear previous errors
            errorItems.innerHTML = '';
            
            if (validationResult.isCorrect) {
                modalHeader.className = 'modal-header success';
                successModalIcon.classList.remove('hidden');
                errorModalIcon.classList.add('hidden');
                modalTitle.className = 'modal-title success';
                modalTitle.textContent = 'ยอดเยี่ยม! ถูกต้อง';
                modalText.textContent = 'คุณคำนวณได้อย่างแม่นยำ';
                errorList.classList.add('hidden');
                modalButton.className = 'modal-button success';
                modalButton.textContent = 'ทำข้อต่อไป';
            } else {
                modalHeader.className = 'modal-header error';
                successModalIcon.classList.add('hidden');
                errorModalIcon.classList.remove('hidden');
                modalTitle.className = 'modal-title error';
                modalTitle.textContent = 'ยังไม่ถูกต้อง';
                modalText.textContent = 'ลองตรวจสอบจุดที่ผิดแล้วแก้ไขอีกครั้ง';
                errorList.classList.remove('hidden');
                modalButton.className = 'modal-button error';
                modalButton.textContent = 'กลับไปแก้ไข';
                
                // Add error items
                Object.entries(validationResult.errors).forEach(([key, msg]) => {
                    const li = document.createElement('li');
                    li.className = 'error-item';
                    li.innerHTML = `
                        <span class="error-dot"></span>
                        <span>${msg}</span>
                    `;
                    errorItems.appendChild(li);
                });
            }
            
            validationModal.classList.remove('hidden');
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
